# ---------------------------------------------------------------
# production stage
# ---------------------------------------------------------------
ARG IMAGE_TAG
ARG IMAGE_NAME
ARG DEMO_IO_WEBSERVER_SOURCE_PATH
ARG DEMO_IO_WEBSERVER_ROOT
ARG DEMO_IO_PHP_ROOT
ARG DEMO_IO_PHP_FASTCGI_GATEWAY

FROM ${IMAGE_NAME}:${IMAGE_TAG} as production
COPY /.deploy/etc/nginx/templates/prod /etc/nginx/templates
COPY ${DEMO_IO_WEBSERVER_SOURCE_PATH} ${DEMO_IO_WEBSERVER_ROOT}

ENV DEMO_IO_WEBSERVER_ROOT=${DEMO_IO_WEBSERVER_ROOT}
ENV DEMO_IO_PHP_FASTCGI_GATEWAY=${DEMO_IO_PHP_FASTCGI_GATEWAY}
ENV DEMO_IO_PHP_ROOT=${DEMO_IO_PHP_ROOT}
ENV BASE_IMAGE=${IMAGE_NAME}:${IMAGE_TAG}

# ---------------------------------------------------------------
# dev/local stage
# ---------------------------------------------------------------
ARG IMAGE_TAG
ARG IMAGE_NAME
FROM ${IMAGE_NAME}-dev:${IMAGE_TAG} as dev

ARG DEMO_IO_WEBSERVER_TARGET_PATH
ARG DEMO_IO_PHP_ROOT
ARG DEMO_IO_PHP_FASTCGI_GATEWAY
ARG IMAGE_TAG
ARG IMAGE_NAME

ENV DEMO_IO_WEBSERVER_ROOT=${DEMO_IO_WEBSERVER_TARGET_PATH}
ENV DEMO_IO_PHP_FASTCGI_GATEWAY=${DEMO_IO_PHP_FASTCGI_GATEWAY}
ENV DEMO_IO_PHP_ROOT=${DEMO_IO_PHP_ROOT}
ENV BASE_IMAGE=${IMAGE_NAME}-dev:${IMAGE_TAG}